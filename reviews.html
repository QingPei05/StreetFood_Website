<!doctype html>
<html lang="en" data-bs-theme="light">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Reviews — Explore Street Food</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <!-- Shared Auth Gate -->
  <script src="scripts/auth-gate.js"></script>

  <!-- Navbar -->
  <div data-include="partials/navbar.html"></div>

  <main class="container py-5">
    <h1 class="mb-4">Leave a Review</h1>
    <form id="form" class="row g-3 needs-validation" novalidate>
      <div class="col-md-6">
        <label class="form-label">Food</label>
        <input required class="form-control" id="food" placeholder="e.g., Satay" />
        <div class="invalid-feedback">Please enter a food name.</div>
      </div>
      <div class="col-md-6">
        <label class="form-label">Your Name</label>
        <input required class="form-control" id="name" placeholder="e.g., Ali" />
        <div class="invalid-feedback">Please enter your name.</div>
      </div>
      <div class="col-md-12">
        <label class="form-label">Comment</label>
        <textarea required class="form-control" id="comment" rows="3" placeholder="What did you like?"></textarea>
        <div class="invalid-feedback">Please add a comment.</div>
      </div>
      <div class="col-md-4">
        <label class="form-label">Rating</label>
        <input type="number" id="rating" class="form-control" min="1" max="5" value="5" required />
        <div class="invalid-feedback">Rating must be 1–5.</div>
      </div>
      <div class="col-12 d-flex gap-2">
        <button class="btn btn-primary" type="submit">Submit</button>
        <button class="btn btn-outline-secondary" type="button" id="clear">Clear All</button>
      </div>
    </form>

    <hr class="my-4" />
    <h2 class="h4">Recent Reviews</h2>
    <div id="list" class="mt-3"></div>
  </main>

  <div data-include="partials/footer.html"></div>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="partials/loader.js"></script>
  <script src="main.js"></script>
  <script>
    const form = document.getElementById('form');
    form.addEventListener('submit', e => {
      form.classList.add('was-validated');
      if (!form.checkValidity()) { e.preventDefault(); e.stopPropagation(); return; }
      e.preventDefault();
      const entry = { food: food.value.trim(), name: name.value.trim(), comment: comment.value.trim(), rating: +rating.value, ts: Date.now() };
      const arr = JSON.parse(localStorage.getItem('reviews') || '[]'); arr.unshift(entry);
      localStorage.setItem('reviews', JSON.stringify(arr));
      form.reset(); form.classList.remove('was-validated'); render();
    });
    document.getElementById('clear').onclick = () => { localStorage.removeItem('reviews'); render(); }
    function render() {
      const list = document.getElementById('list'); list.innerHTML = '';
      const arr = JSON.parse(localStorage.getItem('reviews') || '[]');
      if (arr.length === 0) { list.innerHTML = '<div class="alert alert-info">No reviews yet.</div>'; return; }
      arr.forEach(x => {
        const d = new Date(x.ts).toLocaleString();
        list.insertAdjacentHTML('beforeend', `
          <div class="card mb-2"><div class="card-body">
            <div class="d-flex justify-content-between"><strong>${x.food}</strong><span class="text-warning">${'★'.repeat(x.rating)}${'☆'.repeat(5 - x.rating)}</span></div>
            <small class="text-muted">by ${x.name} • ${d}</small>
            <p class="mb-0 mt-2">${x.comment}</p>
          </div></div>`);
      });
    }
    render();
  </script>
</body>

</html>